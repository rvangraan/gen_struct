%%--------------------------------------------------------------------------------------------------
-compile([{parse_transform, gen_struct_transform}]).
%%--------------------------------------------------------------------------------------------------
-include_lib("gen_struct/include/gen_struct_export.hrl").
%%--------------------------------------------------------------------------------------------------
-define(PRIMARY_KEY(Key), '=pk'() -> Key).
-define(SERIAL_FIELD(Key), '=serial'() -> Key).
%%--------------------------------------------------------------------------------------------------
%% Constructors
%%--------------------------------------------------------------------------------------------------

new() ->
  init( gen_struct:new(?MODULE) ).

%%--------------------------------------------------------------------------------------------------

new(Proplist) ->
  init( gen_struct:new(?MODULE, Proplist) ).

%%--------------------------------------------------------------------------------------------------

new_from_list(Proplist) ->
  init( gen_struct:new_from_list(?MODULE, Proplist) ).

%%--------------------------------------------------------------------------------------------------

new_from_tuple(List) ->
  init( gen_struct:new_from_tuple(?MODULE, List) ).    

%%--------------------------------------------------------------------------------------------------

new_from_proplist(Proplist) ->
  init( gen_struct:new_from_proplist(?MODULE, Proplist) ).    

%%--------------------------------------------------------------------------------------------------
%% Set/Get
%%--------------------------------------------------------------------------------------------------

fset(Field, Value, Struct) ->
  gen_struct:fset(?MODULE, Struct, Field, Value).

%%--------------------------------------------------------------------------------------------------

fset(Proplist, Struct) ->
  gen_struct:fset(?MODULE, Struct, Proplist).

%%--------------------------------------------------------------------------------------------------

fget(Field, Struct) ->
  gen_struct:fget(?MODULE, Struct, Field).

%%--------------------------------------------------------------------------------------------------

fget(Field, DefVal, Struct) ->
  gen_struct:fget(?MODULE, Struct, Field, DefVal).

%%--------------------------------------------------------------------------------------------------
%% Exports
%%--------------------------------------------------------------------------------------------------

to_list(Struct) ->
  gen_struct:to_list(?MODULE, Struct).

%%--------------------------------------------------------------------------------------------------

to_tuple(Struct) ->
  gen_struct:to_tuple(?MODULE, Struct).

%%--------------------------------------------------------------------------------------------------

to_proplist(Struct) ->
  gen_struct:to_proplist(?MODULE, Struct).

%%--------------------------------------------------------------------------------------------------

to_proplist(Opts, Struct) ->
  gen_struct:to_proplist(?MODULE, Struct, Opts).

%%--------------------------------------------------------------------------------------------------

to_json(Struct) ->
  gen_struct:to_json(?MODULE, Struct).

%%--------------------------------------------------------------------------------------------------
%% DBI
%%--------------------------------------------------------------------------------------------------
%% TODO: macro if/end

insert(DBH, Struct) ->
  gen_dbi_struct:insert(?MODULE, Struct, DBH).

%%--------------------------------------------------------------------------------------------------

delete(DBH, Struct) when ?MODULE =:= element(1, Struct) ->
  gen_dbi_struct:delete(?MODULE, Struct, DBH).

%%--------------------------------------------------------------------------------------------------

lookup(DBH) ->
  gen_dbi_struct:lookup(?MODULE, DBH).

lookup(DBH, PrimaryKey) when is_tuple(PrimaryKey) ->
  gen_dbi_struct:lookup(?MODULE, DBH, PrimaryKey);

lookup(DBH, Proplist) when is_list(Proplist) ->
  gen_dbi_struct:lookup(?MODULE, DBH, Proplist).  

%%--------------------------------------------------------------------------------------------------